# Image Edit Webåº”ç”¨ç¨‹åº

åŸºäºQwenæ¨¡å‹çš„æ™ºèƒ½å›¾åƒç¼–è¾‘å·¥å…·ï¼Œæä¾›Webç•Œé¢å’ŒRESTful APIã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ¨ **æ™ºèƒ½å›¾åƒç¼–è¾‘**: åŸºäºQwen Image Editæ¨¡å‹ï¼Œæ”¯æŒè‡ªç„¶è¯­è¨€æè¿°çš„å›¾åƒç¼–è¾‘
- ğŸŒ **Webç•Œé¢**: ç¾è§‚æ˜“ç”¨çš„Webå‰ç«¯ï¼Œæ”¯æŒæ‹–æ‹½ä¸Šä¼ å’Œå‚æ•°è°ƒæ•´
- ğŸ”Œ **RESTful API**: å®Œæ•´çš„APIæ¥å£ï¼Œæ”¯æŒç¨‹åºåŒ–è°ƒç”¨
- ğŸ” **APIå¯†é’¥ç®¡ç†**: å®‰å…¨çš„APIå¯†é’¥ç³»ç»Ÿï¼Œæ”¯æŒå¤šç”¨æˆ·è®¿é—®æ§åˆ¶
- âš™ï¸ **å‚æ•°æ§åˆ¶**: æ”¯æŒè°ƒæ•´CFG Scaleã€æ¨ç†æ­¥æ•°ã€éšæœºç§å­ç­‰å‚æ•°
- ğŸ“± **å“åº”å¼è®¾è®¡**: æ”¯æŒæ¡Œé¢å’Œç§»åŠ¨è®¾å¤‡è®¿é—®

## é¡¹ç›®ç»“æ„

```
qwen-image-edit/
â”œâ”€â”€ app.py                 # ä¸»åº”ç”¨ç¨‹åº
â”œâ”€â”€ config.py              # é…ç½®æ–‡ä»¶
â”œâ”€â”€ start.py              # å¯åŠ¨è„šæœ¬
â”œâ”€â”€ manage_api_keys.py    # APIå¯†é’¥ç®¡ç†å·¥å…·
â”œâ”€â”€ requirements.txt      # Pythonä¾èµ–é¡¹
â”œâ”€â”€ example.py           # åŸå§‹ç¤ºä¾‹ä»£ç 
â”œâ”€â”€ quick_start.bat      # Windows å¿«é€Ÿå¯åŠ¨è„šæœ¬
â”œâ”€â”€ templates/
â”‚   â””â”€â”€ index.html       # Webå‰ç«¯æ¨¡æ¿
â”œâ”€â”€ uploads/             # ä¸Šä¼ çš„å›¾åƒæ–‡ä»¶ (è‡ªåŠ¨åˆ›å»º)
â”œâ”€â”€ outputs/             # ç”Ÿæˆçš„å›¾åƒæ–‡ä»¶ (è‡ªåŠ¨åˆ›å»º)
â””â”€â”€ api_keys.json        # APIå¯†é’¥å­˜å‚¨ (è‡ªåŠ¨ç”Ÿæˆ)
```

## å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬ï¼ˆæ¨èï¼‰

**ä¸€é”®å¯åŠ¨**ï¼š
```bash
install.bat or
install.sh
```

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨å®‰è£…

#### 1. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
```bash
python -m venv qwen-image-edit-env

# Windows æ¿€æ´»
qwen-image-edit-env\Scripts\activate

# Linux/macOS æ¿€æ´»
source qwen-image-edit-env/bin/activate
```

#### 2. å®‰è£…ä¾èµ–é¡¹
```bash
pip install -r requirements.txt
```

#### 3. åˆ›å»ºAPIå¯†é’¥

```bash
python manage_api_keys.py create my_first_key
```

### 3. å¯åŠ¨åº”ç”¨ç¨‹åº

**æ–¹å¼ä¸€: ä½¿ç”¨å¯åŠ¨è„šæœ¬**
```bash
python start.py
```

**æ–¹å¼äºŒ: ç›´æ¥å¯åŠ¨**
```bash
python app.py
```

### 4. è®¿é—®Webç•Œé¢

åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€: http://localhost:5000

## ä½¿ç”¨è¯´æ˜

### Webç•Œé¢ä½¿ç”¨

1. åœ¨æµè§ˆå™¨ä¸­è®¿é—® `http://localhost:5000`
2. è¾“å…¥æ‚¨çš„APIå¯†é’¥
3. ä¸Šä¼ è¦ç¼–è¾‘çš„å›¾åƒæ–‡ä»¶
4. è¾“å…¥ç¼–è¾‘æç¤ºè¯ (ä¾‹å¦‚: "Change the rabbit's color to purple")
5. è°ƒæ•´å‚æ•° (å¯é€‰)
6. ç‚¹å‡»"å¼€å§‹ç¼–è¾‘å›¾åƒ"æŒ‰é’®
7. ç­‰å¾…å¤„ç†å®Œæˆï¼ŒæŸ¥çœ‹ç¼–è¾‘ç»“æœ

### APIæ¥å£ä½¿ç”¨

**ç«¯ç‚¹**: `POST /api/edit-image`

**è¯·æ±‚å¤´**:
```
X-API-Key: <your_api_key>
Content-Type: multipart/form-data
```

**è¯·æ±‚å‚æ•°**:
- `image` (æ–‡ä»¶): è¦ç¼–è¾‘çš„å›¾åƒæ–‡ä»¶
- `prompt` (å­—ç¬¦ä¸²): ç¼–è¾‘æç¤ºè¯
- `negative_prompt` (å­—ç¬¦ä¸², å¯é€‰): è´Ÿé¢æç¤ºè¯
- `true_cfg_scale` (æµ®ç‚¹æ•°, å¯é€‰): CFG Scale (é»˜è®¤: 4.0)
- `num_inference_steps` (æ•´æ•°, å¯é€‰): æ¨ç†æ­¥æ•° (é»˜è®¤: 50)
- `seed` (æ•´æ•°, å¯é€‰): éšæœºç§å­ (é»˜è®¤: 0)

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "output_image": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA...",
  "output_path": "outputs/output_20231201_143022_abc12345.png",
  "parameters": {
    "prompt": "Change the rabbit's color to purple",
    "negative_prompt": "",
    "true_cfg_scale": 4.0,
    "num_inference_steps": 50,
    "seed": 0
  }
}
```

**Python APIè°ƒç”¨ç¤ºä¾‹**:
```python
import requests

url = "http://localhost:5000/api/edit-image"
headers = {"X-API-Key": "your_api_key_here"}
files = {"image": open("input.png", "rb")}
data = {
    "prompt": "Change the rabbit's color to purple",
    "true_cfg_scale": 4.0,
    "num_inference_steps": 50
}

response = requests.post(url, headers=headers, files=files, data=data)
result = response.json()
```

## APIå¯†é’¥ç®¡ç†

### åˆ›å»ºAPIå¯†é’¥
```bash
python manage_api_keys.py create <å¯†é’¥åç§°>
```

### åˆ—å‡ºæ‰€æœ‰APIå¯†é’¥
```bash
python manage_api_keys.py list
```

### åˆ é™¤APIå¯†é’¥
```bash
python manage_api_keys.py delete <å¯†é’¥åç§°>
```

### æŸ¥çœ‹å¸®åŠ©
```bash
python manage_api_keys.py help
```

## æµ‹è¯•å·¥å…·

ä½¿ç”¨å†…ç½®çš„æµ‹è¯•è„šæœ¬éªŒè¯APIåŠŸèƒ½:

```bash
python test_api.py
```

æµ‹è¯•è„šæœ¬æ”¯æŒ:
- APIåŠŸèƒ½æµ‹è¯•
- åˆ›å»ºæµ‹è¯•å›¾åƒ
- éªŒè¯APIå¯†é’¥æœ‰æ•ˆæ€§

## å‚æ•°è¯´æ˜

### ç¼–è¾‘å‚æ•°

- **prompt**: ç¼–è¾‘æç¤ºè¯ï¼Œæè¿°æ‚¨æƒ³è¦çš„å›¾åƒå˜åŒ–
- **negative_prompt**: è´Ÿé¢æç¤ºè¯ï¼Œæè¿°ä¸å¸Œæœ›å‡ºç°çš„å†…å®¹
- **true_cfg_scale**: Classifier-Free Guidance Scale (1.0-20.0)
  - è¾ƒä½å€¼: æ›´è‡ªç”±çš„åˆ›ä½œ
  - è¾ƒé«˜å€¼: æ›´ä¸¥æ ¼éµå¾ªæç¤ºè¯
- **num_inference_steps**: æ¨ç†æ­¥æ•° (10-100)
  - æ›´å¤šæ­¥æ•°é€šå¸¸äº§ç”Ÿæ›´å¥½çš„è´¨é‡ï¼Œä½†å¤„ç†æ—¶é—´æ›´é•¿
- **seed**: éšæœºç§å­
  - ç›¸åŒç§å­äº§ç”Ÿç›¸åŒç»“æœï¼Œç”¨äºå¤ç°ç¼–è¾‘æ•ˆæœ

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **GPUå†…å­˜ä¸è¶³**
   - å‡å°‘å›¾åƒåˆ†è¾¨ç‡
   - é™ä½ `num_inference_steps`
   - ä½¿ç”¨CPUæ¨¡å¼ (ä¿®æ”¹ `app.py` ä¸­çš„è®¾å¤‡è®¾ç½®)

2. **æ¨¡å‹ä¸‹è½½å¤±è´¥**
   - æ£€æŸ¥ç½‘ç»œè¿æ¥
   - ä½¿ç”¨é•œåƒæºæˆ–æ‰‹åŠ¨ä¸‹è½½æ¨¡å‹

3. **APIå¯†é’¥æ— æ•ˆ**
   - æ£€æŸ¥å¯†é’¥æ˜¯å¦æ­£ç¡®
   - ç¡®è®¤å¯†é’¥æœªè¢«åˆ é™¤

4. **ç«¯å£å†²çª**
   - ä¿®æ”¹ `app.py` ä¸­çš„ç«¯å£è®¾ç½®
   - æ£€æŸ¥5000ç«¯å£æ˜¯å¦è¢«å ç”¨

### æ€§èƒ½ä¼˜åŒ–

1. **ä½¿ç”¨GPUåŠ é€Ÿ**
   - ç¡®ä¿å®‰è£…äº†æ­£ç¡®çš„CUDAç‰ˆæœ¬
   - æ£€æŸ¥PyTorch CUDAæ”¯æŒ

2. **æ‰¹é‡å¤„ç†**
   - å¯¹äºå¤§é‡å›¾åƒï¼Œè€ƒè™‘å®ç°æ‰¹é‡å¤„ç†åŠŸèƒ½

3. **æ¨¡å‹ç¼“å­˜**
   - æ¨¡å‹åœ¨é¦–æ¬¡åŠ è½½åä¼šä¿æŒåœ¨å†…å­˜ä¸­ï¼Œåç»­è¯·æ±‚æ›´å¿«

## å®‰å…¨æ³¨æ„äº‹é¡¹

- APIå¯†é’¥åº”å½“ä¿å¯†ï¼Œä¸è¦åœ¨å…¬å…±åœºæ‰€æ³„éœ²
- åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå»ºè®®ä½¿ç”¨HTTPS
- å®šæœŸè½®æ¢APIå¯†é’¥
- ç›‘æ§APIä½¿ç”¨æƒ…å†µï¼Œé˜²æ­¢æ»¥ç”¨

## è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäºMITè®¸å¯è¯å¼€æºã€‚

---

**æ³¨æ„**: æœ¬é¡¹ç›®ä¾èµ–äºQwen Image Editæ¨¡å‹ï¼Œè¯·ç¡®ä¿éµå®ˆç›¸å…³çš„ä½¿ç”¨æ¡æ¬¾å’Œè®¸å¯è¯è¦æ±‚ã€‚
